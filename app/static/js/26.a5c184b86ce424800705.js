webpackJsonp([26],{Dj7p:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={name:"ticketBook",components:{Header:i("FCAx").a},data:function(){return{title:"创建订单",isback:!0,color:"#FF6400",info:{},friends:[],check:[],ID:"",userTime:null,price:0,checked:!1,mobile:"",idCard:"",username:"",value:1,show:!1,currentDate:new Date,minDate:new Date,show2:!1,phone:"",useid:"",showadd:!1,password:"",checkIndex:null,checkchange:!0}},methods:{init:function(){var e=this,t=this.$route.params.id;this.id=t,this.$http.post("/appServiceOrder/ticket/writeinformation",{productId:t}).then(function(t){"success"==t.msg&&(e.info=t.data,e.queryGeneralContact(),e.queryTicketPrice())})},queryGeneralContact:function(){var e=this;this.$http.post("/appServiceOrder/queryGeneralContact").then(function(t){if("success"==t.msg){e.friends=t.data,e.check=[];for(var i=0;i<t.data.length;i++)e.check.push(!1)}})},queryTicketPrice:function(){var e=this;this.$http.post("/appServiceOrder/queryTicketPrice",{productId:this.id,useTime:this.userTime||(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate()}).then(function(t){"success"==t.msg&&(e.price=t.data.price)})},checkFriend:function(e){this.checkIndex=e+1;for(var t=0;t<this.friends.length;t++)this.check[t]=!1,t==e&&(this.check[t]=!0,this.username=this.friends[t].contactName,this.phone=this.friends[t].contactMobile)},showpopup:function(){this.show=!0},confirm:function(e){this.userTime=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),this.show=!1,this.queryTicketPrice()},cancel:function(){this.show=!1},detail:function(){this.show2=!0},add:function(){this.showadd=!0},beforeClose:function(e,t){"confirm"===e?setTimeout(t,1e3):t()},submit:function(){var e=this;if(this.value>0)if(this.userTime)if(11==this.phone.length)if(""!==this.username){var t={buyNumber:this.value,useTime:this.userTime,occupantMobile:this.phone,occupantName:this.username,productId:this.id};this.$http.post("/appServiceOrder/submitAdvanceOrder/ticket",t).then(function(t){if("success"==t.msg){if(1==e.$proType)return window.open("https://m.3xgc.com/#/payment/1/"+e.id+"?userId="+JSON.parse(localStorage.getItem("userInfo")).userId+t.data.orderId,"_self"),!1;e.$router.push({name:"payment",params:{id:t.data.orderId,type:1},query:{userId:JSON.parse(localStorage.getItem("userInfo")).userId}})}})}else this.$toast("请填写预订人");else this.$toast("请填写正确手机号");else this.$toast("请选择出行日期");else this.$toast("购买数量不能小于1")},blur:function(){var e=this;if(this.checkIndex){var t=this.check;if(this.username==this.friends[this.checkIndex-1].contactName&&this.phone==this.friends[this.checkIndex-1].contactMobile){for(var i=0;i<this.friends.length;i++)t[i]=!1;t[this.checkIndex-1]=!0}else for(i=0;i<this.friends.length;i++)t[i]=!1;this.checkchange=!1,this.$nextTick(function(){e.check=t,e.checkchange=!0})}}},computed:{},created:function(){this.init()},mounted:function(){}},a={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ticketBook",attrs:{id:"ticketbook"}},[s("div",{staticClass:"topBar"},[s("Header",{attrs:{title:e.title,color:e.color}})],1),e._v(" "),s("div",{staticStyle:{width:"100%",height:".92rem"}}),e._v(" "),s("router-link",{staticClass:"detail",staticStyle:{background:"#FF6400"},attrs:{to:1==e.info.businessType?{name:"scenicDetail",params:{id:e.info.businessNumber}}:{name:"grangedetail",params:{id:e.info.businessNumber}},tag:"div"}},[s("img",{attrs:{src:i("M4GF"),alt:""}}),e._v(" "),s("div",[s("h3",[e._v(e._s(e.info.businessName))]),e._v(" "),s("p",[e._v(e._s(e.info.ticketName))])])]),e._v(" "),s("div",{staticClass:"item"},[s("div",{staticClass:"separate"}),e._v(" "),s("div",{staticClass:"date"},[s("van-cell-group",[s("van-field",{attrs:{readonly:"",clearable:"",label:"使用日期",placeholder:"请选择出行日期"},on:{click:e.showpopup},model:{value:e.userTime,callback:function(t){e.userTime=t},expression:"userTime"}})],1)],1),e._v(" "),s("div",{staticClass:"mount"},[s("span",[e._v("购买数量")]),e._v(" "),s("van-stepper",{staticClass:"pp",model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),e._v(" "),s("div",{staticClass:"separate"}),e._v(" "),e._m(0),e._v(" "),e.friends.length>0?s("div",{staticClass:"nameadd"},e._l(e.friends,function(t,i){return e.checkchange?s("span",{style:"background:#"+(e.check[i]?"FF6500; color: #fff":"E6E6E6; color: #808080")+";",on:{click:function(t){e.checkFriend(i)}}},[e._v(e._s(t.contactName))]):e._e()})):e._e(),e._v(" "),s("van-cell-group",{staticClass:"floatL"},[s("van-field",{attrs:{label:"预订人",placeholder:"请输入用户名"},on:{blur:e.blur},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),s("van-field",{attrs:{label:"手机",placeholder:"请输入手机号"},on:{blur:e.blur},model:{value:e.phone,callback:function(t){e.phone=t},expression:"phone"}})],1),e._v(" "),s("div",{staticClass:"agreement"},[s("van-checkbox",{model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v("我同意该协议")])],1)],1),e._v(" "),s("div",{staticClass:"bottom clear",staticStyle:{position:"fixed",bottom:"0",left:"0","font-size":".26rem",color:"#606063","background-color":"white"}},[s("div",[s("span",[e._v("总价")]),e._v(" "),s("span",{staticClass:"price"},[e._v("￥"),s("span",{staticStyle:{"font-size":".3rem"}},[e._v(e._s(e.price*e.value))]),e._v(" 元")])]),e._v(" "),s("p",[s("button",{staticStyle:{color:"#606063"},on:{click:e.detail}},[e._v("明细 "),s("i",{staticClass:"iconfont icon-shangsanjiaoxiangshangmianxing"})]),e._v(" "),e.checked&&e.value>0&&""!==e.username&&11==e.phone.length&&e.userTime?s("span",{on:{click:e.submit}},[e._v("\n        提交订单\n      ")]):s("span",{staticStyle:{background:"#B2B2B2"}},[e._v("\n        提交订单\n      ")])])]),e._v(" "),s("van-popup",{attrs:{position:"bottom"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[s("van-datetime-picker",{attrs:{type:"date","min-date":e.minDate},on:{confirm:e.confirm,cancel:e.cancel},model:{value:e.currentDate,callback:function(t){e.currentDate=t},expression:"currentDate"}})],1),e._v(" "),s("van-popup",{attrs:{position:"bottom"},model:{value:e.show2,callback:function(t){e.show2=t},expression:"show2"}},[s("div",{staticStyle:{"line-height":".8rem","fon-size":".26rem",padding:"0 .2rem","box-sizing":"border-box",color:"#1e1e1e","background-color":"#e3e3e4"}},[e._v("价格明细")]),e._v(" "),s("div",{staticStyle:{"line-height":".8rem","fon-size":".26rem",padding:"0 .2rem","box-sizing":"border-box",color:"#1e1e1e"}},[s("p",{staticStyle:{float:"left"}},[e._v("门票")]),e._v(" "),s("p",{staticStyle:{float:"right"}},[e._v(e._s(e.price)+"元 * "+e._s(e.value)+"张")])])]),e._v(" "),s("van-dialog",{attrs:{"show-cancel-button":"","before-close":e.beforeClose,title:"新增"},model:{value:e.showadd,callback:function(t){e.showadd=t},expression:"showadd"}},[s("van-field",{attrs:{label:"姓名",placeholder:"请输入您的真实姓名"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),s("van-field",{attrs:{type:"password",label:"证件号",placeholder:"请输入您的身份证号"},model:{value:e.idCard,callback:function(t){e.idCard=t},expression:"idCard"}}),e._v(" "),s("van-field",{attrs:{label:"手机号",placeholder:"请输入手机号"},model:{value:e.mobile,callback:function(t){e.mobile=t},expression:"mobile"}})],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"verify"},[t("span",[this._v("\n      预订信息\n      ")]),this._v("\n      需填1位，用于入园验证\n    ")])}]};var n=i("VU/8")(s,a,!1,function(e){i("RbQ3"),i("jq90")},"data-v-49864d06",null);t.default=n.exports},M4GF:function(e,t,i){e.exports=i.p+"static/img/ticket-Bg.454d7b9.png"},RbQ3:function(e,t){},jq90:function(e,t){}});