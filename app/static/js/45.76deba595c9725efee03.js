webpackJsonp([45],{Yqz5:function(t,e){},fkK8:function(t,e){},g6of:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("7qok"),i={name:"grangeDetailcomment",components:{Header:a("56oB").a},data:function(){return{active:["住宿","美食","游玩"],num:1,value:0,message:"",autosize:{maxHeight:300,minHeight:200},title:"写点评",isback:!0,imglist:[],landid:null,useid:null}},methods:{uploadimg:function(t){var e=this,a=t.target.files[0],i=a.size/1024/1024,n=a.name.substring(a.name.lastIndexOf(".")+1,a.name.length).toLocaleLowerCase(),o=new FormData,l=(new Date).getTime()+Math.floor(999999*Math.random())+"."+n;if(o.append("key",l),"jpg"!=n&&"bmp"!=n&&"png"!=n&&"jpeg"!=n)return this.$toast("上传图片格式不正确"),!1;if(i>10)return this.$toast("上传的图片不得大于10MB"),!1;var c=s.a.genUpToken(2,l);o.append("token",c),o.append("file",a);var u=s.a.niuUrl[1];this.$http.postImg("https://upload.qiniu.com/",o,null,null,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}).then(function(t){e.imglist.push(u+t.key),console.log(e.imglist)})},tab:function(t){this.num=t+1,console.log(this.num)},delIMg:function(t){this.imglist.splice(t,1)},rateChange:function(){console.log(this.value)},submit:function(){var t=this,e=this.imglist.join(",");if(console.log(this.message),""!=this.message)if(0!=this.value){var a={commentType:this.num,grangeId:this.landid,starLevel:this.value,comment:this.message,images:e,userId:this.useid};this.$http.post("appServiceGrange/comment",a).then(function(e){"success"==e.msg?(t.$toast("评论成功"),setTimeout(function(){t.$router.go(-1)})):t.$toast(e.info)})}else this.$toast("请评分");else this.$toast("请输入评论内容")}},computed:{},created:function(){console.log(s.a),this.landid=this.$route.params.id,this.useid=JSON.parse(localStorage.getItem("userInfo")).userId},mounted:function(){}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"grangeDetailcomment"},[a("div",{staticClass:"topBar"},[a("Header",{attrs:{title:t.title,isback:t.isback}})],1),t._v(" "),a("div",{staticStyle:{height:"0.9rem"}}),t._v(" "),a("div",{staticClass:"top clear"},t._l(t.active,function(e,s){return a("p",{class:{orange:t.num==s+1},attrs:{keys:s},on:{click:function(e){t.tab(s)}}},[t._v(t._s(e))])})),t._v(" "),a("div",{staticClass:"rates"},[a("span",[t._v("*")]),t._v("总体评分"),a("van-rate",{on:{change:t.rateChange},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),t._v(" "),a("div",{staticClass:"comment"},[a("van-cell-group",[a("van-field",{attrs:{label:"评价",type:"textarea",placeholder:"请输入您的评价内容",autosize:t.autosize,required:""},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1)],1),t._v(" "),a("div",{staticClass:"upload"},[a("p",[t._v("上传图片")]),t._v(" "),a("div",{staticClass:"buttonimg"},[t._l(t.imglist,function(e,s){return a("div",[a("img",{attrs:{src:e,alt:""}}),t._v(" "),a("i",{on:{click:function(e){t.delIMg(s)}}},[t._v("删除")])])}),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.imglist.length<=3,expression:"imglist.length<=3"}]},[a("input",{attrs:{type:"file"},on:{change:function(e){t.uploadimg(e)}}})])],2)]),t._v(" "),a("div",{staticClass:"bottom",on:{click:t.submit}},[t._v("发 布")])])},staticRenderFns:[]};var o=a("VU/8")(i,n,!1,function(t){a("Yqz5"),a("fkK8")},"data-v-440a8a6b",null);e.default=o.exports}});